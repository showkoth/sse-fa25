# HW3_Part 1: Security Vulnerability Fixes
### Author: Showkot Hossain

This document describes the fixes implemented for the security vulnerabilities identified in HW2.

## Overview
Four critical security vulnerabilities were identified and fixed:
1. SQL Injection (CWE-89)
2. Cross-Site Scripting - XSS (CWE-79)
3. Insecure Direct Object Reference - IDOR (CWE-639/CWE-862)
4. Hard-coded Secret Key (CWE-321)

## Fix 1: SQL Injection Prevention

**File:** `website/tasktracker/views.py`, line 37 in `add()` function

**Original Vulnerable Code:**
```python
with connection.cursor() as cursor:
    cursor.executescript(f"INSERT INTO tasktracker_task(user_id, status, due_date, title) VALUES ({request.user.id},'{status}', '{due_date}', '{title}')")
```

**Fixed Code:**
```python
# FIX: Replaced vulnerable raw SQL with Django ORM to prevent SQL injection
# Django ORM automatically sanitizes inputs and uses parameterized queries
task.save()
```

**Explanation:**
- Replaced raw SQL with Django ORM's `save()` method
- Django ORM automatically uses parameterized queries which prevent SQL injection
- User input is properly sanitized and escaped before database insertion
- This prevents attackers from injecting malicious SQL code through form fields

## Fix 2: Cross-Site Scripting (XSS) Prevention

**File:** `website/tasktracker/templates/index.html`, line 11

**Original Vulnerable Code:**
```html
<b>Task #{{t.id}}: {{t.title | safe}}</b>
```

**Fixed Code:**
```html
<!-- FIX: Removed | safe filter to enable automatic HTML escaping and prevent XSS attacks -->
<!-- Django automatically escapes HTML characters like <, >, &, and quotes -->
<b>Task #{{t.id}}: {{t.title}}</b>
```

**Explanation:**
- Removed the `| safe` filter which was disabling HTML escaping
- Django now automatically escapes HTML special characters in user input
- Prevents stored XSS attacks where malicious JavaScript could be executed
- Malicious scripts in task titles are now rendered as harmless text

## Fix 3: Insecure Direct Object Reference (IDOR) Prevention

**File:** `website/tasktracker/views.py`, lines 51-56 in `delete()` function

**Original Vulnerable Code:**
```python
def delete(request, pk):
    task = Task.objects.get(id = pk)
    task.delete()
    return HttpResponseRedirect(reverse(f'tasktracker:index'))
```

**Fixed Code:**
```python
def delete(request, pk):
    # FIX: Added authorization check to prevent IDOR vulnerability
    # Only allow users to delete their own tasks
    if request.user.is_authenticated:
        try:
            # Filter by both ID and user to ensure ownership
            task = Task.objects.get(id=pk, user=request.user)
            task.delete()
        except Task.DoesNotExist:
            # Task doesn't exist or doesn't belong to the user
            # Redirect to index without deletion
            pass
    # redirects user to index page
    return HttpResponseRedirect(reverse(f'tasktracker:index'))
```

**Explanation:**
- Added authentication check to ensure user is logged in
- Added exception handling for non-existent or unauthorized tasks
- Prevents users from deleting other users' tasks by manipulating URL parameters
- Users can only access and delete their own tasks

## Fix 4: Hard-coded Secret Key Prevention

**File:** `website/website/settings.py`, line 23

**Original Vulnerable Code:**
```python
SECRET_KEY = '#n6kks0cs$a-7k*67)k(nof$7z6&l+u97ea)nl_r8frg_mrmd1'
```

**Fixed Code:**
```python
# FIX: Use environment variable for secret key instead of hard-coding it
# This prevents the secret key from being exposed in source code
import os
SECRET_KEY = os.environ.get('DJANGO_SECRET_KEY', 'development-key-change-in-production')
```

**Explanation:**
- Moved secret key to environment variable `DJANGO_SECRET_KEY`
- Prevents secret key exposure in version control systems
- Enables different keys for different environments (dev, staging, production)
- Reduces risk of session hijacking and CSRF token forgery
